# リーダブルコード 覚書

せっかく読み直したので、まとめだけでもまとめておく

## 1 章 - 理解しやすいコード

- **コードはほかの人が最短時間で理解できるように書かなくてはならない**

## 1 部 - 表面上の改善

### 2 章 - 名前に情報を詰め込む

- **明確な単語を選ぶ**  
  Get ではなく、状況に応じて Fetch や Download を使う

- **tmp や retval などの汎用的な名前は避ける**  
  ただし、明確な理由がある場合は別だ。

  > 事実として一時的で短命な変数に tmp とつけるのは妥当。スコープが小さい変数なら短い命名でもよい。

- **具体的な名前を使って、物事を詳細に説明する。**  
  ServerCanStart() より CanListenOnPort() の方が明確だ。

  > DISALLOW_EVIL_CONSTRUCTOR という名前は抽象的すぎる。

- **変数名に大事な情報を追加する**
  ミリ秒を表す変数名には、後ろに \_ms を付ける。これからエスケープが必要な場合には、前に raw\_ をつける。

  > raw_password など。全部につけるというよりは、変数の意味を間違えたらバグになりそうなところ、セキュリティにかかわる部分など。

- **スコープの大きな変数には長い名前を付ける**
  スコープが数画面に及ぶ変数に１～２文字の短い暗号めいた名前をつけてはいけない。短い名前はスコープが数行の変数に着けるべきだ

- **大文字やアンダースコアなどに意味を含める。**
  例えば、クラスのメンバ変数にアンダースコアを付けて、ローカル変数と区別する。

### 3 章 - 名前に情報を詰め込む

- **あいまいな単語を使わない**

  - 例えば、文字列における length はあいまいな単語に当たる。chars、depth、bytes などが考えられる。
  - filter もあいまいな単語に当たる。select、exclude など使うとわかりやすい。
  - 限界値に limit を使うのもその値を含むかどうかであいまいになる。限界値は min-max （含む）、範囲は、first-last （含む）、begin-end （含まない）を使おう。

- **ブール値の名づけに規則を作る**
  真偽値は is や has などを使う。否定形は避ける。

- **ユーザーの期待に注意する**
  get() や size() は軽量であることが期待される。

### 4 章 - 美しさ

- 複数のコードブロックで同じようなことをしていたら、シルエットも同じようなものにする。

- コードの「列」を整列すれば、概要が把握しやすくなる。

- ある場所で A・B・C のように並んでいたものを、他の場所で B・A・C のように並べてはいけない。意味のある順番を選んで、常にその順番を守る。

- 空行を使って大きなブロックを論理的な「段落」に分ける。
  > 段落ごとに内容を要約したコメントを書くのもいい

### 5 章 - コメントすべきことを知る

- **コメントすべきではないこと**

  - コードがすぐに抽出できること。

  - ひどいコード（例えば、ひどい名前の関数）を補う「補助的なコメント」。コメントを書くのではなくコードを修正する。

- **記録すべき自分の考え**

  - なぜコードがほかのやり方ではなくこうなっているのか（「監督のコメンタリー）」

  - コードの欠陥を **TODO:** や **XXX:** などの記法を使って示す。

  - 定数の値にまつわる「背景」。
    > マジックナンバーの理由、説明とか

- **読み手の立場になって考える**

  - コードを読んだ人が「えっ？」と思うところを予想してコメントをつける。

  - 平均的な読み手が驚くような動作は文書化しておく。

  - ファイルやクラスには「全体像」のコメントを書く。

  - 読み手が細部にとらわれないように、コードブロックにコメントをつけて概要をまとめる。

### 6 章 - コメントは正確で簡潔に

- **複数のものを指す可能性がある「それ」や「これ」などの代名詞を避ける。**  
  あるいは文章を組み替えて、「それ」が明確にただ一つを指すように書く。

- **関数の動作はできるだけ正確に説明する**

  - 行数をカウントする → `\n` をカウントする。
  - コメントで入出力などの実例をつける。
    > 単純すぎる例を使わず、エッジケースやコーナーケースを使って、「この場合はどうなる？」といったこまい疑問が出にくいようにする。  
    > また、入力と出力の関係性を勘違いさせうる例を避けてスマートに例示する。  
    > 配列を分割する関数で、返り値が「１」になる例では、引数の要素から「１」を避ける、など。

- **コードの意図は、詳細レベルではなく、高レベルで記述する**

  - 配列を逆順に走査する → 値段の降順に走査する、など。冗長検査にもなってバグの混入防止になる。

- **よくわからない引数にはインラインコメントを使う**  
  `connect(/* timeout_ms = */ 10, /* use_encryption = */ false);`

  > 正直いって読みにくいと思う。

- **多くの意味が詰め込まれた言葉や表現を使って、コメントを簡潔に保つ**  
  キャッシュ、正規化など、よく知られた言葉を使って簡潔に説明する。
  > 変数の命名における、あいまいな言葉を使わない、とは反対の方針に見える。

---

## 2 部 - ループとロジックの単純化

### 7 章 - 制御フローを読みやすくする

- **比較は左側に変化する値、右側により変化しない値を置く**  
  `if (num <= max_num)` をあえてひっくり返すことはない
- **if/else 分のブロックは適切に並び変える**  
  一般的には、肯定する条件（否定でない条件）、単純な条件、目立つ条件を先に処理する。
- **三項演算子、do/while、goto などはコードが読みにくくなることが多い。適切に扱い、代替があるなら使わないことを考える。**  
  簡潔に表現できるなら三項演算子の方が読みやすいことは多い。`do/while` は大抵の場合は `while` に置き換えられる。`goto` は C 以外ならば必ず回避できる。
- **ネストしているとコードを追うのに集中力が必要になる。深いコードを避けるには「直線的」なコードを選択する。ガード節が特に便利だ**
